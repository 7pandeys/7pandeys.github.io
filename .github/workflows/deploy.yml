name: ğŸš€ Build and Deploy GitHub Pages

on:
  push:
    branches: [main]  # Trigger on push to main
  workflow_dispatch:   # Allow manual trigger from GitHub UI

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout source code
        uses: actions/checkout@v4

      - name: ğŸ§° Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: ğŸ“¦ Install TailwindCSS
        run: |
          npm init -y
          npm install -D tailwindcss@latest postcss autoprefixer
          npx tailwindcss init

      - name: ğŸ“„ Create input.css
        run: |
          echo '@tailwind base;\n@tailwind components;\n@tailwind utilities;' > input.css

      - name: âœï¸ Add build script to package.json
        run: |
          jq '.scripts.build="tailwindcss -i ./input.css -o ./dist/style.css --minify"' package.json > tmp.json && mv tmp.json package.json

      - name: ğŸ“ Create dist directory
        run: mkdir -p dist

      - name: ğŸ“œ Create index.html (LinkedIn-style profile)
        run: |
          cat <<EOF > dist/index.html
          <!DOCTYPE html>
          <html lang="en">
          <head>
            <meta charset="UTF-8">
            <title>Sandeep Pandey | Data Engineer</title>
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <link href="style.css" rel="stylesheet">
          </head>
          <body class="bg-gray-100 text-gray-900 font-sans">
            <div class="min-h-screen flex flex-col items-center justify-center p-6">
              <div class="bg-white shadow-2xl rounded-2xl p-8 max-w-2xl w-full">
                <div class="flex flex-col items-center text-center">
                  <img src="https://avatars.githubusercontent.com/u/991" alt="Profile" class="w-32 h-32 rounded-full border-4 border-blue-500 shadow-md mb-4">
                  <h1 class="text-3xl font-bold mb-1">Sandeep Pandey</h1>
                  <p class="text-blue-600 text-lg font-medium">Data Engineer | AI Explorer | ğŸ‡®ğŸ‡³</p>
                  <p class="mt-4 text-gray-600">Iâ€™m passionate about building scalable data pipelines, exploring LLMs, and making tech work for impact. Letâ€™s connect!</p>
                </div>
                <div class="mt-6 flex flex-wrap justify-center gap-4">
                  <a href="https://www.linkedin.com/in/YOURUSERNAME" target="_blank" class="bg-blue-500 text-white px-4 py-2 rounded-xl hover:bg-blue-600">LinkedIn</a>
                  <a href="https://github.com/YOURUSERNAME" target="_blank" class="bg-gray-800 text-white px-4 py-2 rounded-xl hover:bg-black">GitHub</a>
                  <a href="mailto:you@example.com" class="bg-green-500 text-white px-4 py-2 rounded-xl hover:bg-green-600">Email Me</a>
                </div>
              </div>
            </div>
          </body>
          </html>
          EOF

      - name: ğŸ”§ Build Tailwind CSS
        run: npm run build

      - name: ğŸ—ƒ Move style.css to dist
        run: mv dist/style.css dist/style.css  # Already output here but ensures correctness

      - name: âš™ï¸ Setup GitHub Pages
        uses: actions/configure-pages@v4

      - name: ğŸ“¤ Upload site artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: dist

      - name: ğŸš€ Deploy to GitHub Pages
        uses: actions/deploy-pages@v4
